<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="csrf-token" content="{{ csrf_token() }}" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>达达后台管理</title>
    <link rel="shortcut icon" href="{{ asset('access/common/img/favicon.ico') }}" type="image/x-icon" />

    <!-- CSS 部分 -->
    <!-- Bootstrap -->
    <link rel="stylesheet" href="{{ asset('bootstrap/css/bootstrap.css') }}">
    <!-- Layui -->
    <!-- <link rel="stylesheet" href="{{ asset('layui/dist/css/layui.css') }}"> -->
    <!-- Bootstrap table -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.13.1/bootstrap-table.min.css">

    <!-- Bootstrap-select -->
    <link rel="stylesheet" href="{{ asset('bootstrap-select-1.13.0-dev/dist/css/bootstrap-select.min.css') }}">

    <style type="text/css">
        .datepicker {
            background-color: white;
        }

    </style>

    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
    <!-- <script src="{{ asset('js/jquery-2.2.4.min.js') }}"></script> -->
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link href="https://cdn.bootcss.com/bootstrap-table/1.11.1/bootstrap-table.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/bootstrap-table/1.11.1/bootstrap-table.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap-table/1.11.1/locale/bootstrap-table-zh-CN.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.13.0/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.13.0/locale/nl.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.37/js/bootstrap-datetimepicker.min.js"></script>

    <!-- bootstarp-select -->
    <script src="{{ asset('bootstrap-select-1.13.0-dev/dist/js/bootstrap-select.min.js') }}"></script>

</head>
<body class="layui-layout-body">
<div style="height: 50px;width: 200px;border-bottom: 2px solid #999;margin-left: 15px;text-align: left;line-height: 50px;font-size: 18px;font-weight: bold;text-indent: 1em;">主页</div>
<div class="panel-body" style="padding-bottom:0px;">
    <div class="panel panel-default">
        <div class="panel-heading">查询条件</div>
        <div class="panel-body">
            <form id="formSearch" class="form-horizontal">
                <div class="form-group" style="margin-top:15px">
                    <div  class="row">
                        <label class="control-label col-sm-1" for="startDate">起始日期</label>
                        <div class="col-sm-3">
                            <div class="input-group datepicker">
                                <input type="text" class="form-control" id="startDate">
                                <span class="input-group-addon">
										<span class="fa fa-calendar"></span>
									</span>
                            </div>
                        </div>
                        <label class="control-label col-sm-1" for="endDate">结束日期</label>
                        <div class="col-sm-3">
                            <div class="input-group datepicker">
                                <input type="text" class="form-control" id="endDate">
                                <span class="input-group-addon">
										<span class="fa fa-calendar"></span>
									</span>
                            </div>
                        </div>
                    </div>
                    <br>
                    <div  class="row">
                        <label class="control-label col-sm-1" for="mark">备注</label>
                        <div class="col-sm-3">
                            <input type="text" class="form-control" id="mark">
                        </div>
                        <label class="control-label col-sm-1" for="txt_search_statu">分类</label>
                        <div class="col-sm-3">
                            <select class="selectpicker" id="type">
                                <option value="0">--请选择--</option>
                                @foreach($type as $t)
                                <option value="{{$t->id}}">{{$t->name}}</option>
                                @endforeach
                            </select>
                        </div>
                    </div>
                    <!-- <div class="col-sm-4" style="text-align:left;">
                        <button type="button" style="margin-left:50px" id="btn_query" class="btn btn-primary">查询</button>
                    </div> -->
                </div>
            </form>
        </div>
    </div>

    <div id="toolbar" class="btn-group">
        <button id="btn_add" type="button" class="btn btn-default">
            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>新增
        </button>
        <!-- <button id="btn_edit" type="button" class="btn btn-default">
            <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>修改
        </button> -->
        <button id="btn_delete" type="button" class="btn btn-default">
            <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>删除
        </button>
    </div>

    <table id="table"></table>
    <!-- <div id="table"></div> -->
</div>
{{--<button type="button" class="btn btn-primary" data-toggle="modal" data-target=".bs-example-modal-lg">Large modal</button>--}}
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="myModal">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel" style="text-align: center;">新增达达记录</h4>
            </div>
            <div class="modal-body">
                <form action="" class="form-horizontal">
                    <div class="form-group">
                        <label for="" class="col-sm-2 control-label">大洋</label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" id="edit-cost">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="" class="col-sm-2 control-label">备注</label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" id="edit-mark">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="" class="col-sm-2 control-label" >类别</label>
                        <div class="col-sm-9">
                            <select class="selectpicker" id="edit-type">
                                <option value="0">--请选择--</option>
                                @foreach($type as $t)
                                <option value="{{$t->id}}">{{$t->name}}</option>
                                @endforeach
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="" class="col-sm-2 control-label" >时间</label>
                        <div class="col-sm-3">
                            <div class="input-group datepicker">
                                <input type="text" class="form-control" id="edit-date">
                                <span class="input-group-addon">
										<span class="fa fa-calendar"></span>
									</span>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary" id="sava-edit-btn">保存</button>
            </div>
        </div>
    </div>
</div>

<!-- jQuery 3 -->
<!-- <script src="{{ asset('access/common/js/jquery-3.1.1.min.js') }}"></script> -->
<!-- bootstrap -->
<!-- <script src="{{ asset('bootstrap/js/bootstrap.js') }}"></script> -->
<!-- <script src="{{ asset('bootstrap/js/bootstrap.js') }}"></script> -->

<!-- <script src="{{ asset('bootstrap-table-master/src/bootstrap-table.js') }}"></script> -->
<!--汉化文件，放在 bootstrap-table.js 后面-->
<!-- <script src="{{ asset('bootstrap-table-master/dist/locale/bootstrap-table-zh-CN.js') }}"></script> -->

<script type="text/javascript">
    //查询
    $('#table').bootstrapTable({
        url: '/index/home_data',     //请求后台的URL（*）
        method: 'post',           //请求方式（*）
        toolbar: '#toolbar',        //工具按钮用哪个容器
        striped: true,           //是否显示行间隔色
        cache: false,            //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
        pagination: true,          //是否显示分页（*）
        sortable: false,           //是否启用排序
        sortOrder: "asc",          //排序方式
        queryParams: function (params) {
            //这里的键的名字和控制器的变量名必须一致，这边改动，控制器也需要改成一样的
            var temp = {                        //页面大小
                rows: params.limit,                         //页面大小
                page: (params.offset / params.limit) + 1   //页码
            };
            //备注
            temp["startDate"] = $("#startDate").val();
            temp["endDate"] = $("#endDate").val();
            temp["mark"] = $("#mark").val();
            temp["type"] = $("#type").val();
            // console.log(temp)
            return temp;
        },//传递参数
        ajaxOptions:{
            headers:{ 'X-CSRF-TOKEN':$('meta[name="csrf-token"]').attr('content')}//token
        },
        sidePagination: "server",      //分页方式：client客户端分页，server服务端分页（*）
        pageNumber: 1,            //初始化加载第一页，默认第一页
        pageSize: 20,            //每页的记录行数（*）
        pageList: [10, 25, 50, 100],    //可供选择的每页的行数（*）
        search: true,            //是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大
        strictSearch: true,
        showColumns: true,         //是否显示所有的列
        showRefresh: true,         //是否显示刷新按钮
        minimumCountColumns: 2,       //最少允许的列数
        clickToSelect: true,        //是否启用点击选中行
        // height: 10,            //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
        uniqueId: "id",           //每一行的唯一标识，一般为主键列
        showToggle: false,          //是否显示详细视图和列表视图的切换按钮
        cardView: false,          //是否显示详细视图
        detailView: false,          //是否显示父子表
        showExport: true, //是否显示导出按钮
        buttonsAlign: "right", //按钮位置
        exportTypes: ['excel'], //导出文件类型
        Icons: 'glyphicon-export',
        columns: [{
            checkbox: true
        }, {
            field: 'id',
            title: 'id'
        }, {
            field: 'mark',
            title: '备注'
        }, {
            field: 'money',
            title: '费用'
        }, {
            field: 't_name',
            title: '分类'
        }, {
            field: 'use_time_str',
            title: '日期'
        }, {
            field: 'create_time_str',
            title: '添加日期'
        }]
    });

    var $table = $("#table");
    var $editbtn = $("#btn_add");
    $(function () {
        $editbtn.click(function () {
            //     var info = $table.bootstrapTable('getSelections')[0];
            //     if(!info){
            //         alert("请选择数据");
            //     }else{
            //         $("#modal_id").val(info.id)
            //         $("#modal_bj_no").val(info.bj_no)
            //         $("#modal_cus_name").val(info.cus_name)
            //         $("#modal_bj_prd").val(info.bj_prd)
            //         $("#modal_up").val(info.up)
            //         $("#modal_mj_cst").val(info.mj_cst)
            $("#myModal").modal();
            //     }
        });

        $("#sava-edit-btn").click(function (){
            var cost = $("#edit-cost").val();
            var type = $("#edit-type").val();
            var mark = $("#edit-mark").val();
            var date = $("#edit-date").val();
            var bool = true;
            if (mark=="") {
                bool = false;
                alert('请填写MARK');
                return false;
            }
            if (cost=="") {
                bool = false;
                alert('请填写COTS');
                return false;
            }
            if (type=="") {
                bool = false;
                alert('请填写TYPE');
                return false;
            }
            if (date=="") {
                bool = false;
                alert('请填写DATE');
                return false;
            }

            //token
            var token = $('meta[name="csrf-token"]').attr('content');
            $.ajax({
                type: "POST",
                url: "save",
                data: {
                    'mark': mark,
                    'cost': cost,
                    'type': type,
                    'date': date,
                    '_token': token
                },
                dataType: "json",
                success: function(data){
                    // console.log(data);
                    if (data.suc == 1) {
                        window.location.reload();
                    } else {
                        alert(data.msg);
                    }
                },
                error:function(data){
                    // console.log(data);
                    alert("网络错误");
                }
            });
        });

        /*
        //获取点击的行的行号 有效：为获得编辑的行号的尝试。
        $table.on("click-row.bs.table",function(e, row, $element) {
                var index= $element.data('index');
                alert(index);
        });
        */

        // //关闭模态框数据保存到table
        // $("#sava-edit-btn").click(function () {
        //     $('#myModal').modal('hide');
        //     var id = $("#modal_id").val();
        //     var new_cus_name = $("#modal_cus_name").val();
        //     var new_bj_prd = $("#modal_bj_prd").val();
        //     var new_up = $("#modal_up").val();
        //     var new_mj_cst = $("#modal_mj_cst").val();
        //
        //     $table.bootstrapTable("updateRow",{
        //         index:index,
        //         row:{
        //             id:id,
        //             cus_name:new_cus_name,
        //             bj_prd:new_bj_prd,
        //             up:new_up,
        //             mj_cst:new_mj_cst
        //         }
        //     });
        // })
    });

    $.ajax({
        type: "POST",
        url: "save",
        data: {
            'mark': mark,
            'cost': cost,
            'type': type,
            'date': date,
            '_token': token
        },
        dataType: "json",
        success: function(data){
            // console.log(data);
            if (data.suc == 1) {
                window.location.reload();
            } else {
                alert(data.msg);
            }
        },
        error:function(data){
            // console.log(data);
            alert("网络错误");
        }
    });



    //DateTimePicker
    var defaults = {

        // calendarWeeks: true,
        showClear: true,
        showClose: true,
        allowInputToggle: true,
        useCurrent: false,
        ignoreReadonly: true,
        // minDate: new Date(),
        toolbarPlacement: 'top',
        locale: 'nl',
        icons: {
            time: 'fa fa-clock-o',
            date: 'fa fa-calendar',
            up: 'fa fa-angle-up',
            down: 'fa fa-angle-down',
            previous: 'fa fa-angle-left',
            next: 'fa fa-angle-right',
            today: 'glyphicon glyphicon-screenshot',
            clear: 'fa fa-trash',
            close: 'fa fa-times'
        }
    };


    $(function() {
        var optionsDatetime = $.extend({}, defaults, {format:'YYYY-MM-DD HH:mm'});
        var optionsDate = $.extend({}, defaults, {format:'YYYY-MM-DD'});
        var optionsTime = $.extend({}, defaults, {format:'HH:mm'});

        $('.datepicker').datetimepicker(optionsDate);
        $('.timepicker').datetimepicker(optionsTime);
        $('.datetimepicker').datetimepicker(optionsDatetime);

    });

</script>

</body>
</html>